# 小魔仙RAG智能体待办功能与优化列表

## 待办功能列表

## 高优先级功能

### 已完成
- [x] 实现基础RAG功能 - 将Obsidian笔记索引到向量数据库并检索相关信息
- [x] 集成Ollama API - 支持通过API使用本地模型进行嵌入计算
- [x] 提示词工程 - 构建有效的提示词模板以提高回答质量
- [x] 意图识别系统 - 区分闲聊、知识查询、工具请求等不同类型
- [x] 历史对话感知查询重写 - 将指代性表达替换为具体历史信息
- [x] 分离硬编码提示词 - 将提示词从代码中分离到独立模板文件
- [x] 幻觉检测与预防机制 - 集成双重检测机制减少大模型幻觉
- [x] 优化检索策略 - 采用自适应相似度过滤提高文档检索准确性
- [x] 添加详细日志输出 - 确保关键方法和判断分支都有足够日志
- [x] 合并提示词模板 - 将幻觉检测和预防提示词模板合并管理
- [x] 提示词中文化 - 确保所有提示词优先使用中文版本
- [x] 实现流式响应功能 - 支持实时传输AI生成内容，用户可查看AI思考过程

### 进行中
- [ ] 实现多模态RAG支持 - 支持图像和文档等多类型内容检索
- [ ] 集成更多本地模型 - 支持多种本地模型以提高性能

## 中优先级功能

### 待开始
- [ ] 实现动态知识更新 - 支持实时更新知识库而无需完全重建索引
- [ ] 用户反馈集成 - 基于用户反馈持续优化回答质量
- [ ] 对话记忆管理 - 实现长期对话记忆的管理机制
- [ ] 多语言支持 - 支持中文、英文等多语言混合检索
- [ ] 知识图谱增强 - 构建知识图谱以提高检索精度
- [ ] 高级查询理解 - 实现复杂查询的语义理解
- [ ] 检索结果排序优化 - 基于上下文和用户偏好优化排序
- [ ] 缓存机制 - 缓存常见查询结果以提高响应速度

## 低优先级功能

### 待开始
- [ ] 高级权限管理 - 实现用户权限和数据访问控制
- [ ] API接口 - 提供RESTful API接口供外部应用调用
- [ ] Web界面 - 开发用户友好的Web界面
- [ ] 文档自动分类 - 自动对知识库文档进行分类和标签
- [ ] 智能摘要生成 - 自动生成文档摘要
- [ ] 实时协作功能 - 支持多用户同时使用
- [ ] 高级分析报告 - 提供使用情况和效果分析报告
- [ ] 插件系统 - 支持第三方插件扩展功能

## 技术债务

- [ ] 优化向量数据库性能 - 提高大规模数据下的检索效率
- [ ] 改进错误处理机制 - 提供更详细的错误信息和恢复策略
- [ ] 增加更多单元测试 - 提高代码覆盖率和稳定性
- [ ] 文档完善 - 补充详细的API文档和使用指南
- [ ] 性能监控 - 添加性能指标监控和告警
- [ ] 安全性增强 - 加强数据传输和存储的安全性

---

## 🔧 功能优化

### 向量数据库优化
- [ ] 实现增量索引功能
- [ ] 添加索引更新时间戳
- [ ] 支持索引的增量更新
- [ ] 优化向量数据库性能

### 检索算法优化
- [ ] 实现多种检索策略（语义检索、关键词检索等）
- [ ] 添加检索结果重排序功能
- [ ] 支持多模态检索（未来扩展）
- [ ] 实现检索结果的多样性控制

### 用户界面改进
- [ ] Web 界面支持
- [ ] 支持多轮对话
- [ ] 添加对话历史记录
- [ ] 实现对话记忆功能

---

## 📊 性能优化

### 响应速度优化
- [ ] 模型推理加速
- [ ] 向量检索优化
- [ ] 缓存机制实现
- [ ] 并发处理支持

### 资源管理
- [ ] 内存使用优化
- [ ] 模型加载优化
- [ ] 连接池管理
- [ ] 资源清理机制

---

## 🛡️ 安全与稳定性

### 安全性增强
- [ ] 输入验证和过滤
- [ ] 防止提示注入攻击
- [ ] API 密钥安全管理
- [ ] 访问控制机制

### 稳定性改进
- [ ] 更完善的错误处理
- [ ] 重试机制优化
- [ ] 健壮性测试
- [ ] 监控和日志改进

---

## 📈 扩展功能

### 知识库管理
- [ ] 知识库同步功能
- [ ] 知识库版本管理
- [ ] 知识库备份与恢复
- [ ] 多知识库支持

### 模型管理
- [ ] 多模型支持
- [ ] 模型切换功能
- [ ] 模型性能比较
- [ ] 模型微调支持

---

## 📋 任务状态说明

- 🚀: 高优先级功能
- 🔧: 功能优化
- 📊: 性能优化
- 🛡️: 安全与稳定性
- 📈: 扩展功能

### 状态标记
- [ ] 未开始
- [O] 进行中
- [x] 已完成
- [-] 已取消

---

## ✅ 已完成功能

### V1.6.0 - 高级意图理解功能
- [x] **基于业界最佳实践实现高级意图理解能力**
  - 实现查询分类功能，将用户输入分为chitchat、knowledge_query、tool_request、ambiguous四类
  - 实现历史对话感知的查询重写功能，结合最近3轮对话历史重写查询
  - 实现结构化意图解析，解析出intent、entity、aspect和confidence
  - 添加意图识别准确性保障机制，当confidence<0.7时返回澄清消息
  - 实现轻量级零样本分类，不依赖训练数据
  - 支持JSON Schema格式的结构化输出
  - 优化历史对话查询处理

### V1.5.0 - 意图识别优化
- [x] **基于aidev项目实现方式优化用户意图识别**
  - 添加history_query意图类型，专门处理历史对话查询
  - 实现_query_rewrite_for_independence方法，支持将用户查询重写为独立查询
  - 优化意图识别逻辑，参考aidev项目的实现方式
  - 添加_query_classification_prompt构建方法，支持查询类型分类
  - 实现专门的_history_query识别方法
  - 改进意图识别准确性

### V1.4.0 - 对话历史上下文理解优化
- [x] **优化对话历史上下文理解功能**
  - 实现_is_history_query方法，识别涉及历史对话的查询
  - 实现_handle_history_query方法，专门处理历史对话查询
  - 支持多种历史查询模式（第一个问题、最近对话、特定问题等）
  - 提供友好的历史对话展示格式

### V1.3.0 - 对话历史上下文理解
- [x] **实现对话历史上下文理解功能**
  - 在RAGAgent中添加chat_history属性
  - 实现对话历史的自动记录和管理
  - 支持在查询中传递对话历史给意图识别器
  - 在CLI界面中支持清空对话历史功能

### V1.2.0 - 意图识别功能
- [x] **实现用户意图识别系统**
  - 创建IntentRecognizer类，支持多种意图类型识别
  - 实现基于关键词匹配的初步识别
  - 实现基于LLM的精确意图识别
  - 集成到RAGAgent主流程中
  - 根据意图类型选择不同处理策略

### V1.1.0 - 检索相关性优化
- [x] **解决检索器相关性判断问题** 
  - 实现了基于相似度阈值的文档过滤机制
  - 当没有找到相关文档时，直接使用本地大模型回答
  - 避免将不相关的文档片段传递给模型导致错误结果
  - 更新了Retriever类以分离检索、过滤和格式化逻辑

### 智能回答增强
- [x] 当未找到相关文档时使用本地大模型回答

### 提示词管理重构
- [x] 创建独立的提示词管理模块
- [x] 按功能分类管理提示词模板
- [x] 提高提示词的可维护性

### RAG提示词优化
- [x] 改进RAG提示词模板，更好地处理检索到的文档内容
- [x] 优化文档相关性判断逻辑
