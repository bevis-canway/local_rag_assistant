# 小魔仙RAG智能体功能迭代历史

## 版本 1.0.0 - 初始版本 (2024-12-29)

### 核心功能
- [x] Obsidian 笔记连接器
- [x] 向量数据库（ChromaDB）集成
- [x] Ollama 模型支持
- [x] 文档分块和索引功能
- [x] RAG 检索和问答功能
- [x] 命令行交互界面

### 技术特性
- [x] uv 依赖管理
- [x] Makefile 自动化构建
- [x] 代码质量检查（Ruff）
- [x] 测试套件

---

## 版本 1.1.0 - 环境优化 (2024-12-29)

### 新增功能
- [x] 小魔仙模型（bge-m3:latest）支持
- [x] API 嵌入模式支持
- [x] 环境变量配置优化

### 修复问题
- [x] 修复 NumPy 2.0 兼容性问题
- [x] 修复相对导入问题
- [x] 优化错误处理机制

---

## 版本 1.2.0 - 项目结构优化 (2025-01-01)

### 结构调整
- [x] 创建 tests/ 目录统一存放测试文件
- [x] 创建 scripts/ 目录统一存放脚本文件
- [x] 创建 docs/ 目录统一存放文档
- [x] 创建 roadmap/ 目录统一存放产品路标文档
- [x] 更新 .gitignore 忽略向量数据库目录

### 自动化改进
- [x] 优化 Makefile 命令
- [x] 更新启动脚本使用 uv 管理依赖

---

## 版本 1.3.0 - 智能回答增强 (2025-01-01)

### 新增功能
- [x] 当未找到相关文档时使用本地大模型回答
- [x] 改进用户提示体验
- [x] 增强系统健壮性

### 技术改进
- [x] 在 retriever.py 中添加 LLM 回答功能
- [x] 优化错误处理和日志记录
- [x] 保持与现有系统的兼容性

---

## 版本 1.4.0 - 提示词管理重构 (2025-01-01)

### 重构改进
- [x] 创建 prompts/ 目录统一管理提示词
- [x] 将硬编码提示词提取到独立模块
- [x] 按功能分类管理提示词模板
- [x] 提高提示词的可维护性

### 技术改进
- [x] 创建 prompt_templates.py 统一管理模板
- [x] 更新 retriever.py 使用提示词模板
- [x] 更新 prompt_engineer.py 使用提示词模板
- [x] 保持向后兼容性

---

## 版本 1.5.0 - RAG提示词优化 (2025-01-01)

### 修复改进
- [x] 改进RAG提示词模板，更好地处理检索到的文档内容
- [x] 优化文档相关性判断逻辑
- [x] 提高回答准确性

### 技术改进
- [x] 更新rag_answer模板，优先使用检索到的相关信息
- [x] 改进提示词指导，更好地结合检索内容和通用知识

---

## V1.1.0 - 检索相关性优化版本

### 更新说明
- **日期**: 2025-12-29
- **版本**: v1.1.0
- **主要改进**: 解决了检索器相关性判断问题，当没有找到相关文档时直接使用本地大模型回答，避免将不相关的文档片段传递给模型

### 具体变更
1. **Retriever 类改进**:
   - 添加了 `retrieve_and_filter_by_similarity` 方法，返回过滤后的结果和相关性标志
   - 添加了 `format_results` 方法，分离格式化逻辑
   - 实现了基于相似度阈值的文档过滤

2. **RAGAgent 类改进**:
   - 修改了 `query` 方法，根据是否有相关文档选择不同的处理逻辑
   - 当没有相关文档时，直接使用 `no_document_found` 提示词模板

3. **配置改进**:
   - 保持 `SIMILARITY_THRESHOLD` 配置项，可配置的相似度阈值

### 解决的问题
- 修复了即使没有找到相关文档也显示有文档片段的问题
- 修复了将不相关文档传递给模型导致错误回答的问题
- 提高了用户体验，当知识库中没有相关信息时能给出更自然的回答
