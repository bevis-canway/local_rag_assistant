# 小魔仙RAG智能体功能迭代历史

## 版本 1.0.0 - 初始版本 (2024-12-29)

### 核心功能
- [x] Obsidian 笔记连接器
- [x] 向量数据库（ChromaDB）集成
- [x] Ollama 模型支持
- [x] 文档分块和索引功能
- [x] RAG 检索和问答功能
- [x] 命令行交互界面

### 技术特性
- [x] uv 依赖管理
- [x] Makefile 自动化构建
- [x] 代码质量检查（Ruff）
- [x] 测试套件

---

## 版本 1.1.0 - 环境优化 (2024-12-29)

### 新增功能
- [x] 小魔仙模型（bge-m3:latest）支持
- [x] API 嵌入模式支持
- [x] 环境变量配置优化

### 修复问题
- [x] 修复 NumPy 2.0 兼容性问题
- [x] 修复相对导入问题
- [x] 优化错误处理机制

---

## 版本 1.2.0 - 项目结构优化 (2025-01-01)

### 结构调整
- [x] 创建 tests/ 目录统一存放测试文件
- [x] 创建 scripts/ 目录统一存放脚本文件
- [x] 创建 docs/ 目录统一存放文档
- [x] 创建 roadmap/ 目录统一存放产品路标文档
- [x] 更新 .gitignore 忽略向量数据库目录

### 自动化改进
- [x] 优化 Makefile 命令
- [x] 更新启动脚本使用 uv 管理依赖

---

## 版本 1.3.0 - 智能回答增强 (2025-01-01)

### 新增功能
- [x] 当未找到相关文档时使用本地大模型回答
- [x] 改进用户提示体验
- [x] 增强系统健壮性

### 技术改进
- [x] 在 retriever.py 中添加 LLM 回答功能
- [x] 优化错误处理和日志记录
- [x] 保持与现有系统的兼容性

---

## 版本 1.4.0 - 提示词管理重构 (2025-01-01)

### 重构改进
- [x] 创建 prompts/ 目录统一管理提示词
- [x] 将硬编码提示词提取到独立模块
- [x] 按功能分类管理提示词模板
- [x] 提高提示词的可维护性

### 技术改进
- [x] 创建 prompt_templates.py 统一管理模板
- [x] 更新 retriever.py 使用提示词模板
- [x] 更新 prompt_engineer.py 使用提示词模板
- [x] 保持向后兼容性

---

## 版本 1.5.0 - RAG提示词优化 (2025-01-01)

### 修复改进
- [x] 改进RAG提示词模板，更好地处理检索到的文档内容
- [x] 优化文档相关性判断逻辑
- [x] 提高回答准确性

### 技术改进
- [x] 更新rag_answer模板，优先使用检索到的相关信息
- [x] 改进提示词指导，更好地结合检索内容和通用知识

---

## V1.3.0 - 对话历史上下文理解功能版本

### 更新说明
- **日期**: 2025-12-30
- **版本**: v1.3.0
- **主要改进**: 为小魔仙RAG智能体添加对话历史上下文理解功能，支持多轮对话中的上下文关联

### 具体变更
1. **RAGAgent类改进**:
   - 添加chat_history属性用于存储对话历史
   - 在query方法中支持传递对话历史给意图识别器
   - 实现对话历史的自动管理（添加、限制长度）
   - 在CLI界面中支持对话历史功能

2. **对话历史管理**:
   - 自动记录用户查询和系统响应
   - 限制对话历史长度以优化性能
   - 添加清空对话历史的功能

3. **意图识别增强**:
   - 意图识别器现在可以利用对话历史进行上下文理解
   - 支持基于历史上下文的意图判断

### 解决的问题
- 实现了多轮对话中的上下文理解
- 支持指代消解和上下文相关的查询处理
- 提升了对话的连贯性和自然性

## V1.2.0 - 意图识别功能版本

### 更新说明
- **日期**: 2025-12-30
- **版本**: v1.2.0
- **主要改进**: 为小魔仙RAG智能体添加用户意图识别系统，提升对话理解和响应准确性

### 具体变更
1. **新增IntentRecognizer类**:
   - 实现基于关键词匹配的意图识别
   - 实现基于LLM的意图识别
   - 提供意图类型分类功能
   - 支持对话历史上下文理解

2. **意图类型定义**:
   - general_query: 一般性知识查询
   - specific_info: 特定信息查询
   - clarification: 需要澄清或选择的查询
   - follow_up: 跟进或补充性问题
   - chit_chat: 闲聊或礼貌性回复

3. **集成到RAGAgent**:
   - 在query方法中集成意图识别逻辑
   - 根据意图类型选择不同处理策略
   - 对闲聊类意图直接使用通用模型回答

### 解决的问题
- 提高了系统对用户查询意图的理解准确性
- 减少了无关文档的检索和处理
- 优化了闲聊类查询的响应效率
- 增强了对话的自然性和流畅性

## V1.1.0 - 检索相关性优化版本

### 更新说明
- **日期**: 2025-12-29
- **版本**: v1.1.0
- **主要改进**: 解决了检索器相关性判断问题，当没有找到相关文档时直接使用本地大模型回答，避免将不相关的文档片段传递给模型

### 具体变更
1. **Retriever 类改进**:
   - 添加了 `retrieve_and_filter_by_similarity` 方法，返回过滤后的结果和相关性标志
   - 添加了 `format_results` 方法，分离格式化逻辑
   - 实现了基于相似度阈值的文档过滤

2. **RAGAgent 类改进**:
   - 修改了 `query` 方法，根据是否有相关文档选择不同的处理逻辑
   - 当没有相关文档时，直接使用 `no_document_found` 提示词模板

3. **配置改进**:
   - 保持 `SIMILARITY_THRESHOLD` 配置项，可配置的相似度阈值

### 解决的问题
- 修复了即使没有找到相关文档也显示有文档片段的问题
- 修复了将不相关文档传递给模型导致错误回答的问题
- 提高了用户体验，当知识库中没有相关信息时能给出更自然的回答
