"""
幻觉检测与预防相关提示词模板
专门用于减少大模型生成回答时的幻觉现象
"""

# 幻觉检测与预防提示词模板
HALLUCINATION_TEMPLATES = {
    # 防幻觉基础模板
    "strict_factual_response": """你是一个事实核查助手。你的回答必须严格遵循提供的上下文。

重要规则：
- 只包含在提供上下文中明确陈述的信息
- 如果答案在上下文中无法找到，请明确说明"我无法在提供的文档中找到此信息"
- 不要超出直接陈述内容进行推断或假设
- 不要编造、推断或虚构上下文中不存在的信息
- 当上下文未提供足够信息时，请承认此限制

上下文：
{context}

问题：{query}

回答：""",
    
    "document_based_verification": """请根据提供的文档验证你回答中的每个陈述。

对于你做出的每个陈述：
1. 确定哪些文档支持此陈述
2. 引用或参考具体信息
3. 如果你找不到支持某个陈述的文档，请不要包含它

文档：
{context}

问题：{query}

验证后的回答：""",
    
    "confidence_aware_generation": """基于提供的上下文生成回答，但要表明置信度水平。

对于你回答的每个部分：
- 高置信度：文档中直接陈述的信息
- 中等置信度：从文档中得出的合理推断
- 低置信度：文档中未明确支持的信息

如果回答的任何部分置信度较低，请明确说明此限制。

上下文：
{context}

问题：{query}

带置信度的回答：""",
    
    "fact_extraction_first": """首先从文档中提取所有相关事实，然后形成你的回答。

步骤1：从以下文档中提取相关事实：
{context}

步骤2：确定哪些事实与问题相关：{query}

步骤3：仅使用提取的事实形成你的回答，明确指出文档中未提供信息的情况。

回答：""",
    
    "contradiction_check": """在提供答案之前，请检查与提供的上下文是否存在矛盾。

1. 确定你即将做出的所有声明
2. 针对提供的文档验证每个声明
3. 如果任何声明与文档矛盾，请不要包含它
4. 如果任何声明未被文档支持，请承认此限制

上下文：
{context}

问题：{query}

验证后的回答：""",

    # 幻觉检测模板
    "semantic_consistency_check": """请检查以下生成的回答是否与提供的文档内容一致，没有包含文档中未提及的虚假信息。

文档内容：
{context}

原始查询：{query}

生成的回答：{response}

请分析回答中是否存在与文档不一致或文档中未提及的信息。返回格式：
一致性: [是/否]
置信度: [0-1之间的数值]
不一致之处: [列出不一致的具体内容，如果没有则写"无"]
解释: [简要解释判断依据]
""",
    
    "fact_verification_check": """请验证以下回答中的每个事实是否在提供的文档中得到支持。

文档内容：
{context}

原始查询：{query}

待验证的回答：{response}

请按以下步骤进行验证：
1. 将回答分解为独立的事实陈述
2. 检查每个事实是否在文档中得到支持
3. 列出没有文档支持的不一致信息

输出格式：
一致性: [是/否]
置信度: [0-1之间的数值]
不一致之处: [列出没有文档支持的具体内容，如果没有则写"无"]
解释: [简要解释验证结果]
""",
    
    "document_consistency_check": """请评估生成的回答与文档内容的一致性。

文档内容摘要：
{context}

用户查询：{query}

AI生成的回答：{response}

请仔细比较回答内容与文档内容，判断回答是否基于文档信息生成，是否存在编造或不准确的信息。

输出格式：
一致性: [是/否]
置信度: [0-1之间的数值，数值越高表示一致性越强]
不一致之处: [列出回答中与文档不符的内容，如果没有发现不一致则写"无"]
解释: [简要说明判断依据]
"""
}